<!doctype html><html lang=en><head><title>YoloV5 Deployment Optimization with Neural Magic · Emanuele Viglianisi</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta name=author content="Emanuele Viglianisi"><meta name=description content="Table Of Contents 🔥 Motivation: 🔫 What: 🚒 Why: ⛳ How: 🔩 Setting Up Table Resume Prediction Speed Metrics Test Set F1 Score Sample of video annotation 🙏 Comments & Feedback Follow me 👇 🔥 Motivation: Link to heading As architecture get more complex, for improved prediction results, the generated model are larger and larger, therefore the need to reduce their size and allow the model to run prediction on CPU."><meta name=keywords content="blog,developer,personal"><meta name=twitter:card content="summary"><meta name=twitter:title content="YoloV5 Deployment Optimization with Neural Magic"><meta name=twitter:description content="Table Of Contents 🔥 Motivation: 🔫 What: 🚒 Why: ⛳ How: 🔩 Setting Up Table Resume Prediction Speed Metrics Test Set F1 Score Sample of video annotation 🙏 Comments & Feedback Follow me 👇 🔥 Motivation: Link to heading As architecture get more complex, for improved prediction results, the generated model are larger and larger, therefore the need to reduce their size and allow the model to run prediction on CPU."><meta property="og:title" content="YoloV5 Deployment Optimization with Neural Magic"><meta property="og:description" content="Table Of Contents 🔥 Motivation: 🔫 What: 🚒 Why: ⛳ How: 🔩 Setting Up Table Resume Prediction Speed Metrics Test Set F1 Score Sample of video annotation 🙏 Comments & Feedback Follow me 👇 🔥 Motivation: Link to heading As architecture get more complex, for improved prediction results, the generated model are larger and larger, therefore the need to reduce their size and allow the model to run prediction on CPU."><meta property="og:type" content="article"><meta property="og:url" content="https://emavgl.github.io/posts/second-blog/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-09-16T00:00:00+00:00"><meta property="article:modified_time" content="2022-09-16T00:00:00+00:00"><link rel=canonical href=https://emavgl.github.io/posts/second-blog/><link rel=preload href="https://emavgl.github.io/fonts/forkawesome-webfont.woff2?v=1.2.0" as=font type=font/woff2 crossorigin><link rel=stylesheet href=https://emavgl.github.io/css/coder.min.ea4c355c5f9913809f506132a80bf3fab84f2679dee370f334f7385a36d24c38.css integrity="sha256-6kw1XF+ZE4CfUGEyqAvz+rhPJnne43DzNPc4WjbSTDg=" crossorigin=anonymous media=screen><link rel=icon type=image/svg+xml href=https://emavgl.github.io/images/favicon.svg sizes=any><link rel=icon type=image/png href=https://emavgl.github.io/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=https://emavgl.github.io/images/favicon-16x16.png sizes=16x16><link rel=apple-touch-icon href=https://emavgl.github.io/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=https://emavgl.github.io/images/apple-touch-icon.png><link rel=manifest href=https://emavgl.github.io/site.webmanifest><link rel=mask-icon href=https://emavgl.github.io/images/safari-pinned-tab.svg color=#5bbad5></head><body class="preload-transitions colorscheme-light"><div class=float-container><a id=dark-mode-toggle class=colorscheme-toggle><i class="fa fa-adjust fa-fw" aria-hidden=true></i></a></div><main class=wrapper><head></head><nav class=navigation><section class=container><a class=navigation-title href=https://emavgl.github.io/>Emanuele Viglianisi</a>
<input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=https://emavgl.github.io/about/>About</a></li><li class=navigation-item><a class=navigation-link href=https://emavgl.github.io/posts/>Blog</a></li><li class=navigation-item><a class=navigation-link href=https://emavgl.github.io/projects/>Projects</a></li><li class=navigation-item><a class=navigation-link href=https://emavgl.github.io/contact/>Contact me</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=https://emavgl.github.io/posts/second-blog/>YoloV5 Deployment Optimization with Neural Magic</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa fa-calendar" aria-hidden=true></i>
<time datetime=2022-09-16T00:00:00Z>September 16, 2022</time></span>
<span class=reading-time><i class="fa fa-clock-o" aria-hidden=true></i>
2-minute read</span></div><div class=authors><i class="fa fa-user" aria-hidden=true></i>
<a href=https://emavgl.github.io/authors/fabio-geraci/>Fabio Geraci</a></div><div class=tags><i class="fa fa-tag" aria-hidden=true></i>
<span class=tag><a href=https://emavgl.github.io/tags/yolo/>YOLO</a></span>
<span class=separator>•</span>
<span class=tag><a href=https://emavgl.github.io/tags/neural-magic/>Neural Magic</a></span>
<span class=separator>•</span>
<span class=tag><a href=https://emavgl.github.io/tags/model/>model</a></span>
<span class=separator>•</span>
<span class=tag><a href=https://emavgl.github.io/tags/optimization/>optimization</a></span></div></div></header><div class=post-content><div><h2>Table Of Contents</h2><nav id=TableOfContents><ul><li><a href=#-motivation>🔥 Motivation:</a></li><li><a href=#-what>🔫 What:</a></li><li><a href=#-why>🚒 Why:</a></li><li><a href=#-how>⛳ How:</a></li><li><a href=#-setting-up>🔩 Setting Up</a></li><li><a href=#table-resume-prediction-speed>Table Resume Prediction Speed</a></li><li><a href=#metrics>Metrics</a></li><li><a href=#test-set-f1-score>Test Set F1 Score</a></li><li><a href=#sample-of-video-annotation>Sample of video annotation</a></li><li><a href=#-comments--feedback>🙏 Comments & Feedback</a></li><li><a href=#follow-me->Follow me 👇</a></li></ul></nav></div><h2 id=-motivation>🔥 Motivation:
<a class=heading-link href=#-motivation><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><ul><li>As architecture get more complex, for improved prediction results, the generated model are larger and larger, therefore the need to reduce their size and allow the model to run prediction on CPU. This enables developer to reduce infostructres costs as well as opening the door for edge deployment.</li></ul><h2 id=-what>🔫 What:
<a class=heading-link href=#-what><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><ul><li>I used a blood cells photos, originally open sourced by <a href=https://github.com/cosmicad/dataset class=external-link target=_blank rel=noopener>cosmicad</a>, downloaded from Roboflow Universe (bccd dataset).</li></ul><h2 id=-why>🚒 Why:
<a class=heading-link href=#-why><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><ul><li>I am true beliver that Science and Technology should be used for the benefit of the many, the Medical Industry is and will benefit greatly from all the AI/ML application in development.</li></ul><h2 id=-how>⛳ How:
<a class=heading-link href=#-how><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><ul><li>In this post, I show you how you can supercharge your YOLOv5 inference performance running on CPUs using free and open-source tools by Neural Magic.</li></ul><h2 id=-setting-up>🔩 Setting Up
<a class=heading-link href=#-setting-up><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>I followed the excellent blog <a href=https://dicksonneoh.com/portfolio/supercharging_yolov5_180_fps_cpu/ class=external-link target=_blank rel=noopener>Supercharging YOLOv5</a> from <a href=https://dicksonneoh.com/ class=external-link target=_blank rel=noopener>Dickson Noah</a></p><style>table,tr,th,td{border:1px solid #000}</style><h2 id=table-resume-prediction-speed>Table Resume Prediction Speed
<a class=heading-link href=#table-resume-prediction-speed><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>The table below resumes the findings, and compares tow YOLOv5 networks (s and n) with and without pruning+quantization.</p><table border><tr><th>Model</th><th colspan=2>CPU</th><th colspan=2>GPU</th></tr><tr><th><th>Average inference time per frame (ms)</th><th>Average FPS</th><th>Average inference time per frame (ms)</th><th>Average FPS</th></th></tr><tr><th>Yolov5s</th><th>148.58</th><th>6.73</th><th>36.96</th><th>27.05</th></tr><tr><th>Yolov5s Pruned+Quant</th><th>114.55</th><th>8.72</th><th>NA</th><th>NA</th></tr><tr><th>Yolov5n</th><th>182.67</th><th>5.47</th><th>29.24</th><th>34.18</th></tr><tr><th>Yolov5n Pruned+Quant</th><th>55.62</th><th>17.97</th><th>NA</th><th>NA</th></tr></table><p>The table clearly shows that the Yolov5n Pruned+Quant average FPS is 2.5 times faster than the standard YOLOv5s,
providing similar metrics performances, as shown in the following illustrations</p><h2 id=metrics>Metrics
<a class=heading-link href=#metrics><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><a href="https://wandb.ai/mentorship/YOLOv5/reports/metrics-mAP_0-5-0-95-22-09-23-11-23-19---VmlldzoyNjgzNDY4?accessToken=ogz720cdvdqsxm57bqtxf4c3fhlx4rjwi9rc82wvlgza49lpgg80hmvgsx4o4gah"><figure><img src=https://emavgl.github.io/posts/assets/mAP_0.5_0.95.png width=600 height=300><figcaption><h4>mAP_0.5_0.95</h4></figcaption></figure></a><a href="https://wandb.ai/mentorship/YOLOv5/reports/metrics-mAP_0-5-22-09-23-11-47-41---VmlldzoyNjgzNTkz?accessToken=30gldan2v7twoaroorf408mu6ps1p972z3hg3cwkhtetpeklllqjzjr5tw2xab0m"><figure><img src=https://emavgl.github.io/posts/assets/mAP_0.5.png width=600 height=300><figcaption><h4>mAP_0.5</h4></figcaption></figure></a><a href="https://wandb.ai/mentorship/YOLOv5/reports/metrics-recall-22-09-23-11-47-13---VmlldzoyNjgzNTkw?accessToken=1dxd27obwdhz5ivotnh6ih37dp8lbc3retlzwz3cf1m6gxlkr9n83m11la1657uh"><figure><img src=https://emavgl.github.io/posts/assets/recall.png width=600 height=300><figcaption><h4>recall</h4></figcaption></figure></a><a href="https://wandb.ai/mentorship/YOLOv5/reports/metrics-precision-22-09-23-11-48-11---VmlldzoyNjgzNTk1?accessToken=618lxwy1mzpoeumtrco05tq3pvo4d5kcw01v5177ugzfttmvkqwi9pjycden9uu4"><figure><img src=https://emavgl.github.io/posts/assets/precision.png width=600 height=300><figcaption><h4>precision</h4></figcaption></figure></a><h2 id=test-set-f1-score>Test Set F1 Score
<a class=heading-link href=#test-set-f1-score><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><a><figure><img src=https://emavgl.github.io/posts/assets/F1_curve.png width=600 height=300><figcaption><h4>Prediction Video Sample</h4></figcaption></figure></a><h2 id=sample-of-video-annotation>Sample of video annotation
<a class=heading-link href=#sample-of-video-annotation><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><a><figure><img src=https://emavgl.github.io/posts/assets/video_sample.png width=400 height=400><figcaption><h4>Prediction Video Sample</h4></figcaption></figure></a><h2 id=-comments--feedback>🙏 Comments & Feedback
<a class=heading-link href=#-comments--feedback><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>I hope you’ve learned a thing or two from this blog post. If you have any questions, comments, or feedback, please leave them on the following <a href=https://www.linkedin.com/in/fabiogeraci/ class=external-link target=_blank rel=noopener>LinkedIn</a> or <a href=https://twitter.com/FGeraci73/ class=external-link target=_blank rel=noopener>Twitter</a>.</p><h2 id=follow-me->Follow me 👇
<a class=heading-link href=#follow-me-><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p><a href=https://www.linkedin.com/in/fabiogeraci/ target=_blank rel=noreferrer class=markdown-btn>LinkedIn</a>
<a href=https://twitter.com/FGeraci73/ target=_blank rel=noreferrer class=markdown-btn>Twitter</a></p></div><footer></footer></article></section></div><footer class=footer><section class=container>©
2020 -
2023
Emanuele Viglianisi
·
Powered by <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/ target=_blank rel=noopener>Coder</a>.</section></footer></main><script src=https://emavgl.github.io/js/coder.min.6ae284be93d2d19dad1f02b0039508d9aab3180a12a06dcc71b0b0ef7825a317.js integrity="sha256-auKEvpPS0Z2tHwKwA5UI2aqzGAoSoG3McbCw73gloxc="></script></body></html>